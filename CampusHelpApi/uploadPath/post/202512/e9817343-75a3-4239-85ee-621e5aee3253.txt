<template> <div class="ai-chat-container"> <div class="chat-header"> <span style="font-weight: bold; font-size: 16px"> <i class="el-icon-magic-stick" style="margin-right: 5px; color: #409eff" ></i> 智能助手小互 </span> </div> <div class="chat-window" ref="chatWindow"> <div v-for="(msg, index) in msgList" :key="index" :class="['message-row', msg.role === 'user' ? 'right' : 'left']" > <template v-if="msg.role === 'ai'"> <el-avatar shape="square" :src="aiAvatar" icon="el-icon-s-custom" class="avatar" ></el-avatar> <div class="bubble ai-bubble"> <div style="white-space: pre-wrap; line-height: 1.6"> {{ msg.content }} </div> </div> </template> <template v-else> <div class="bubble user-bubble"> <div style="white-space: pre-wrap; line-height: 1.6"> {{ msg.content }} </div> </div> <el-avatar icon="el-icon-user-solid" class="avatar user-avatar" ></el-avatar> </template> </div> <div v-if="loading" class="message-row left"> <el-avatar shape="square" :src="aiAvatar" icon="el-icon-s-custom" class="avatar" ></el-avatar> <div class="bubble ai-bubble" style="color: #999"> <i class="el-icon-loading"></i> 小互正在思考... </div> </div> </div> <div class="input-area"> <el-input v-model="inputMsg" type="textarea" :rows="2" placeholder="请输入你的问题，按回车发送..." resize="none" @keydown.enter.native.prevent="sendMsg" ></el-input> <el-button type="primary" size="medium" @click="sendMsg" :loading="loading" style="margin-left: 10px; height: 50px; padding: 0 20px" > 发送 </el-button> </div> </div> </template> <script> import request from "@/util/request"; export default { name: "AiHelp", data() { return { aiAvatar: (() => { try { return require("@/assets/img/avator_ai.jpg"); } catch (e) { return ""; } })(), inputMsg: "", loading: false, msgList: [ { role: "ai", content: "你好呀！我是校园智能助手小互，有什么我可以帮你的吗？", }, ], }; }, methods: { sendMsg() { if (!this.inputMsg.trim() || this.loading) return; const text = this.inputMsg; this.msgList.push({ role: "user", content: text }); this.inputMsg = ""; this.scrollToBottom(); this.loading = true; request({ url: "/ai/chat", method: "post", data: { content: text }, }) .then((res) => { const replyText = res.reply || (res.data && res.data.reply) || res.data || "我好像没听清，能再说一遍吗？"; this.msgList.push({ role: "ai", content: replyText }); }) .catch((err) => { console.error(err); this.msgList.push({ role: "ai", content: "网络连接失败，请检查后端服务。", }); }) .finally(() => { this.loading = false; this.scrollToBottom(); }); }, scrollToBottom() { this.$nextTick(() => { const div = this.$refs.chatWindow; if (div) { div.scrollTop = div.scrollHeight; } }); }, }, }; </script> <style scoped> /* --- 核心布局修改 --- */ .ai-chat-container { height: 100%; /* 关键：服从 content-box */ display: flex; flex-direction: column; background-color: #f7f7f7; overflow: hidden; /* 不制造页面滚动 */ } .chat-header { /* 头部高度固定，不许收缩 */ flex-shrink: 0; height: 50px; display: flex; align-items: center; padding: 0 20px; background: #fff; border-bottom: 1px solid #ebeef5; box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); z-index: 10; } .chat-window { /* 关键点：自动占据剩余所有空间 */ flex: 1; width: 100%; padding: 20px; overflow-y: auto; /* 只有这里会滚动 */ box-sizing: border-box; background-color: #f7f7f7; } .input-area { flex-shrink: 0; /* 输入框不许收缩，永远保持在底部 */ padding: 15px 20px; background: #fff; border-top: 1px solid #ddd; display: flex; align-items: flex-start; } /* --- 消息气泡样式 (保持原样优化) --- */ .message-row { display: flex; margin-bottom: 20px; align-items: flex-start; width: 100%; } .left { justify-content: flex-start; } .right { justify-content: flex-end; } .avatar { margin: 0 10px; flex-shrink: 0; width: 40px; height: 40px; border-radius: 4px; } .user-avatar { background-color: #409eff; } .bubble { max-width: 70%; padding: 12px 16px; border-radius: 8px; font-size: 14px; position: relative; word-break: break-word; } .ai-bubble { background-color: #fff; border-top-left-radius: 2px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); color: #333; } .user-bubble { background-color: #409eff; border-top-right-radius: 2px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); color: #fff; } </style>